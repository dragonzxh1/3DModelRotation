<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” é¡¹ç›®è¯Šæ–­å·¥å…·</title>
    
    <!-- Import Map: å®šä¹‰æ¨¡å—è·¯å¾„æ˜ å°„ -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.module.js",
            "three/": "https://cdn.jsdelivr.net/npm/three@0.128.0/",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.128.0/examples/jsm/"
        }
    }
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
            text-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .card h2 {
            color: white;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .test-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border-left: 4px solid transparent;
        }

        .test-item.loading {
            border-left-color: #ffd700;
        }

        .test-item.success {
            border-left-color: #00b894;
        }

        .test-item.error {
            border-left-color: #ff6b6b;
        }

        .test-item .icon {
            font-size: 1.5rem;
            margin-right: 15px;
            min-width: 30px;
        }

        .test-item .name {
            flex: 1;
            color: white;
            font-size: 1.1rem;
        }

        .test-item .status {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }

        .summary {
            text-align: center;
            color: white;
            font-size: 1.2rem;
            padding: 20px;
        }

        .summary.success {
            background: rgba(0, 184, 148, 0.2);
        }

        .summary.error {
            background: rgba(255, 107, 107, 0.2);
        }

        .btn {
            display: inline-block;
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            padding: 12px 30px;
            border-radius: 25px;
            text-decoration: none;
            margin: 10px;
            font-weight: bold;
            transition: transform 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .error-details {
            margin-top: 10px;
            padding: 15px;
            background: rgba(255, 107, 107, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .actions {
            text-align: center;
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” é¡¹ç›®è¯Šæ–­å·¥å…·</h1>

        <div class="card">
            <h2>ğŸ“¦ å¤–éƒ¨åº“æ£€æŸ¥</h2>
            <div id="externalLibs"></div>
        </div>

        <div class="card">
            <h2>ğŸ§© é¡¹ç›®æ¨¡å—æ£€æŸ¥</h2>
            <div id="projectModules"></div>
        </div>

        <div class="card">
            <h2>ğŸ“Š è¯Šæ–­æ€»ç»“</h2>
            <div id="summary" class="summary">æ­£åœ¨æ£€æµ‹...</div>
        </div>

        <div class="actions">
            <a href="../index.html" class="btn">è¿”å›ä¸»é¡µ</a>
            <a href="./test-modules.html" class="btn">è¿è¡Œå®Œæ•´æµ‹è¯•</a>
            <a href="./start-fresh.html" class="btn">æ¸…ç†ç¼“å­˜</a>
        </div>
    </div>

    <script type="module">
        const externalLibsDiv = document.getElementById('externalLibs');
        const projectModulesDiv = document.getElementById('projectModules');
        const summaryDiv = document.getElementById('summary');

        let totalTests = 0;
        let passedTests = 0;
        let failedTests = 0;
        const errors = [];

        function addTestItem(container, name, icon = 'ğŸ“¦') {
            const item = document.createElement('div');
            item.className = 'test-item loading';
            item.innerHTML = `
                <div class="icon">${icon}</div>
                <div class="name">${name}</div>
                <div class="status">æ£€æµ‹ä¸­...</div>
            `;
            container.appendChild(item);
            totalTests++;
            return item;
        }

        function updateTestItem(item, success, message, error = null) {
            item.className = `test-item ${success ? 'success' : 'error'}`;
            const icon = item.querySelector('.icon');
            const status = item.querySelector('.status');
            
            icon.textContent = success ? 'âœ…' : 'âŒ';
            status.textContent = message;

            if (success) {
                passedTests++;
            } else {
                failedTests++;
                if (error) {
                    errors.push({ name: item.querySelector('.name').textContent, error });
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'error-details';
                    errorDiv.textContent = error.toString();
                    item.appendChild(errorDiv);
                }
            }
        }

        async function checkExternalLibs() {
            // æ£€æŸ¥ Three.js
            const threeItem = addTestItem(externalLibsDiv, 'Three.js', 'ğŸ¨');
            try {
                await import('https://cdn.jsdelivr.net/npm/three@0.159.0/build/three.module.js');
                updateTestItem(threeItem, typeof THREE !== 'undefined' || true, 'å·²åŠ è½½ (v0.159.0)');
            } catch (error) {
                updateTestItem(threeItem, false, 'åŠ è½½å¤±è´¥', error);
            }

            // æ£€æŸ¥ GLTFLoader
            const gltfItem = addTestItem(externalLibsDiv, 'GLTFLoader', 'ğŸ“¦');
            try {
                await import('https://cdn.jsdelivr.net/npm/three@0.159.0/examples/jsm/loaders/GLTFLoader.js');
                updateTestItem(gltfItem, true, 'å·²åŠ è½½');
            } catch (error) {
                updateTestItem(gltfItem, false, 'åŠ è½½å¤±è´¥', error);
            }
        }

        async function checkProjectModules() {
            const modules = [
                { name: 'utils.js', icon: 'ğŸ› ï¸' },
                { name: 'renderer.js', icon: 'ğŸ–¼ï¸' },
                { name: 'camera.js', icon: 'ğŸ“·' },
                { name: 'lighting.js', icon: 'ğŸ’¡' },
                { name: 'scene.js', icon: 'ğŸ¬' },
                { name: 'model.js', icon: 'ğŸ²' },
                { name: 'upload.js', icon: 'ğŸ“¤' },
                { name: 'controls.js', icon: 'ğŸ®' },
                { name: 'main.js', icon: 'âš¡' }
            ];

            for (const module of modules) {
                const item = addTestItem(projectModulesDiv, module.name, module.icon);
                try {
                    const imported = await import(`../${module.name}`);
                    const hasExports = Object.keys(imported).length > 0;
                    updateTestItem(
                        item, 
                        hasExports, 
                        hasExports ? `å·²åŠ è½½ (${Object.keys(imported).length} ä¸ªå¯¼å‡º)` : 'å·²åŠ è½½ï¼ˆæ— å¯¼å‡ºï¼‰'
                    );
                } catch (error) {
                    updateTestItem(item, false, 'åŠ è½½å¤±è´¥', error);
                }
            }
        }

        async function runDiagnostic() {
            try {
                await checkExternalLibs();
                await checkProjectModules();

                // æ›´æ–°æ€»ç»“
                const allPassed = failedTests === 0;
                summaryDiv.className = `summary ${allPassed ? 'success' : 'error'}`;
                summaryDiv.innerHTML = `
                    <div style="font-size: 3rem; margin-bottom: 10px;">
                        ${allPassed ? 'âœ…' : 'âš ï¸'}
                    </div>
                    <div>
                        æ€»å…± ${totalTests} é¡¹æ£€æµ‹ï¼Œ
                        <span style="color: #00b894;">${passedTests} é€šè¿‡</span>ï¼Œ
                        <span style="color: #ff6b6b;">${failedTests} å¤±è´¥</span>
                    </div>
                    ${allPassed ? 
                        '<div style="margin-top: 15px; font-size: 1.1rem;">ğŸ‰ æ‰€æœ‰æ£€æµ‹é€šè¿‡ï¼é¡¹ç›®å¯ä»¥æ­£å¸¸è¿è¡Œã€‚</div>' : 
                        '<div style="margin-top: 15px; font-size: 1.1rem;">âš ï¸ å‘ç°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ä¸Šè¿°å¤±è´¥é¡¹ã€‚</div>'
                    }
                `;

                // å¦‚æœæ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Œæ£€æŸ¥ä¸»é¡µ
                if (allPassed) {
                    setTimeout(() => {
                        summaryDiv.innerHTML += `
                            <div style="margin-top: 20px;">
                                <a href="../index.html" class="btn" style="font-size: 1.2rem;">ğŸš€ å‰å¾€ä¸»é¡µ</a>
                            </div>
                        `;
                    }, 500);
                }
            } catch (error) {
                summaryDiv.className = 'summary error';
                summaryDiv.innerHTML = `
                    <div style="font-size: 3rem; margin-bottom: 10px;">âŒ</div>
                    <div>è¯Šæ–­è¿‡ç¨‹å‡ºé”™ï¼š${error.message}</div>
                `;
            }
        }

        // å¯åŠ¨è¯Šæ–­
        runDiagnostic();
    </script>
</body>
</html>

