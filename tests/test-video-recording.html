<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§†é¢‘å½•åˆ¶åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }
        
        .test-section h2 {
            margin-top: 0;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 10px;
        }
        
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .log {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .log-entry {
            margin: 5px 0;
        }
        
        .log-success {
            color: #4CAF50;
        }
        
        .log-error {
            color: #f44336;
        }
        
        .log-info {
            color: #2196F3;
        }
        
        code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 3px;
        }
    </style>
    
    <!-- Import Map -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.module.js",
            "three/": "https://cdn.jsdelivr.net/npm/three@0.128.0/",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.128.0/examples/jsm/"
        }
    }
    </script>
</head>
<body>
    <h1>ğŸ¬ è§†é¢‘å½•åˆ¶åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>æµ‹è¯• 1: æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ</h2>
        <p>æ£€æŸ¥å½“å‰æµè§ˆå™¨æ˜¯å¦æ”¯æŒè§†é¢‘å½•åˆ¶åŠŸèƒ½ã€‚</p>
        <button onclick="testBrowserSupport()">è¿è¡Œæµ‹è¯•</button>
        <div class="log" id="log1"></div>
    </div>
    
    <div class="test-section">
        <h2>æµ‹è¯• 2: åˆ›å»ºå¡ç‰‡å¹¶å¯ç”¨å½•åˆ¶æŒ‰é’®</h2>
        <p>ä½¿ç”¨ç¤ºä¾‹å›¾ç‰‡åˆ›å»º3Då¡ç‰‡ï¼Œå¹¶è‡ªåŠ¨å¯ç”¨å½•åˆ¶æŒ‰é’®ã€‚</p>
        <button onclick="testCreateCardAndEnableRecording()">è¿è¡Œæµ‹è¯•</button>
        <div class="log" id="log2"></div>
    </div>
    
    <div class="test-section">
        <h2>æµ‹è¯• 3: å½•åˆ¶è§†é¢‘ï¼ˆé»˜è®¤å‚æ•°ï¼‰</h2>
        <p>ä½¿ç”¨é»˜è®¤å‚æ•°å½•åˆ¶è§†é¢‘ï¼š5ç§’ï¼Œ60 FPSï¼Œæ—‹è½¬1åœˆã€‚</p>
        <button onclick="testRecordDefault()">è¿è¡Œæµ‹è¯•</button>
        <div class="log" id="log3"></div>
    </div>
    
    <div class="test-section">
        <h2>æµ‹è¯• 4: å½•åˆ¶è§†é¢‘ï¼ˆè‡ªå®šä¹‰å‚æ•°ï¼‰</h2>
        <p>ä½¿ç”¨è‡ªå®šä¹‰å‚æ•°å½•åˆ¶è§†é¢‘ï¼š3ç§’ï¼Œ30 FPSï¼Œæ—‹è½¬0.5åœˆã€‚</p>
        <button onclick="testRecordCustom()">è¿è¡Œæµ‹è¯•</button>
        <div class="log" id="log4"></div>
    </div>
    
    <div class="test-section">
        <h2>æµ‹è¯• 5: ç¼–ç¨‹æ–¹å¼å½•åˆ¶</h2>
        <p>æ¼”ç¤ºé€šè¿‡APIç¼–ç¨‹æ–¹å¼å½•åˆ¶è§†é¢‘ã€‚</p>
        <button onclick="testProgrammaticRecording()">è¿è¡Œæµ‹è¯•</button>
        <div class="log" id="log5"></div>
    </div>
    
    <script type="module">
        import app from '../main.js';
        
        // ç­‰å¾…åº”ç”¨åˆå§‹åŒ–
        await new Promise(resolve => {
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', resolve);
            } else {
                resolve();
            }
        });
        
        // ç­‰å¾…ä¸€å°æ®µæ—¶é—´ç¡®ä¿å®Œå…¨åˆå§‹åŒ–
        await new Promise(resolve => setTimeout(resolve, 100));
        
        // å°†appæš´éœ²ç»™å…¨å±€ä»¥ä¾¿æµ‹è¯•å‡½æ•°ä½¿ç”¨
        window.testApp = app;
        
        // è¾…åŠ©å‡½æ•°ï¼šæ·»åŠ æ—¥å¿—
        function addLog(logId, message, type = 'info') {
            const log = document.getElementById(logId);
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }
        
        // è¾…åŠ©å‡½æ•°ï¼šæ¸…ç©ºæ—¥å¿—
        function clearLog(logId) {
            document.getElementById(logId).innerHTML = '';
        }
        
        // è¾…åŠ©å‡½æ•°ï¼šç”Ÿæˆæµ‹è¯•å›¾ç‰‡
        function generateTestImage(text, color) {
            const canvas = document.createElement('canvas');
            canvas.width = 512;
            canvas.height = 512;
            const ctx = canvas.getContext('2d');
            
            // èƒŒæ™¯
            ctx.fillStyle = color;
            ctx.fillRect(0, 0, 512, 512);
            
            // æ–‡å­—
            ctx.fillStyle = 'white';
            ctx.font = 'bold 48px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(text, 256, 256);
            
            return canvas.toDataURL('image/png');
        }
        
        // æµ‹è¯• 1: æµè§ˆå™¨æ”¯æŒæ£€æŸ¥
        window.testBrowserSupport = function() {
            clearLog('log1');
            addLog('log1', 'å¼€å§‹æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ...', 'info');
            
            const videoRecorder = window.testApp.getVideoRecorder();
            
            if (videoRecorder.isSupported()) {
                addLog('log1', 'âœ“ æµè§ˆå™¨æ”¯æŒè§†é¢‘å½•åˆ¶åŠŸèƒ½', 'success');
                
                const mimeType = videoRecorder.getSupportedMimeType();
                addLog('log1', `æ”¯æŒçš„MIMEç±»å‹: ${mimeType}`, 'info');
                
                // æ£€æŸ¥å…·ä½“ç¼–ç æ”¯æŒ
                const vp9 = MediaRecorder.isTypeSupported('video/webm;codecs=vp9');
                const vp8 = MediaRecorder.isTypeSupported('video/webm;codecs=vp8');
                
                addLog('log1', `VP9ç¼–ç æ”¯æŒ: ${vp9 ? 'æ˜¯' : 'å¦'}`, vp9 ? 'success' : 'error');
                addLog('log1', `VP8ç¼–ç æ”¯æŒ: ${vp8 ? 'æ˜¯' : 'å¦'}`, vp8 ? 'success' : 'error');
            } else {
                addLog('log1', 'âœ— æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘å½•åˆ¶åŠŸèƒ½', 'error');
                addLog('log1', 'è¯·ä½¿ç”¨ Chromeã€Firefox æˆ– Edge æµè§ˆå™¨', 'error');
            }
        };
        
        // æµ‹è¯• 2: åˆ›å»ºå¡ç‰‡å¹¶å¯ç”¨å½•åˆ¶
        window.testCreateCardAndEnableRecording = async function() {
            clearLog('log2');
            addLog('log2', 'å¼€å§‹åˆ›å»º3Då¡ç‰‡...', 'info');
            
            try {
                const frontImage = generateTestImage('æ­£é¢', '#3498db');
                const backImage = generateTestImage('èƒŒé¢', '#e74c3c');
                
                addLog('log2', 'å·²ç”Ÿæˆæµ‹è¯•å›¾ç‰‡', 'info');
                
                const uploadManager = window.testApp.getUploadManager();
                await uploadManager.createCard({
                    frontImageData: frontImage,
                    backImageData: backImage
                });
                
                addLog('log2', 'âœ“ 3Då¡ç‰‡åˆ›å»ºæˆåŠŸ', 'success');
                addLog('log2', 'âœ“ å½•åˆ¶æŒ‰é’®å·²è‡ªåŠ¨å¯ç”¨', 'success');
                
                // æ£€æŸ¥æŒ‰é’®çŠ¶æ€
                const recordButton = document.getElementById('recordButton');
                if (recordButton && !recordButton.disabled) {
                    addLog('log2', 'å½•åˆ¶æŒ‰é’®çŠ¶æ€: å·²å¯ç”¨', 'success');
                } else {
                    addLog('log2', 'è­¦å‘Š: å½•åˆ¶æŒ‰é’®æœªå¯ç”¨', 'error');
                }
            } catch (error) {
                addLog('log2', `âœ— é”™è¯¯: ${error.message}`, 'error');
            }
        };
        
        // æµ‹è¯• 3: é»˜è®¤å‚æ•°å½•åˆ¶
        window.testRecordDefault = async function() {
            clearLog('log3');
            
            const cube = window.testApp.getModelManager().getCube();
            if (!cube) {
                addLog('log3', 'è¯·å…ˆè¿è¡Œæµ‹è¯•2åˆ›å»º3Då¡ç‰‡', 'error');
                return;
            }
            
            addLog('log3', 'å¼€å§‹å½•åˆ¶è§†é¢‘ï¼ˆé»˜è®¤å‚æ•°ï¼‰...', 'info');
            addLog('log3', 'å‚æ•°: 5ç§’, 60 FPS, æ—‹è½¬1åœˆ', 'info');
            
            try {
                const videoRecorder = window.testApp.getVideoRecorder();
                await videoRecorder.recordVideo();
                
                addLog('log3', 'âœ“ è§†é¢‘å½•åˆ¶å®Œæˆ', 'success');
                addLog('log3', 'âœ“ è§†é¢‘å·²è‡ªåŠ¨ä¸‹è½½', 'success');
            } catch (error) {
                addLog('log3', `âœ— é”™è¯¯: ${error.message}`, 'error');
            }
        };
        
        // æµ‹è¯• 4: è‡ªå®šä¹‰å‚æ•°å½•åˆ¶
        window.testRecordCustom = async function() {
            clearLog('log4');
            
            const cube = window.testApp.getModelManager().getCube();
            if (!cube) {
                addLog('log4', 'è¯·å…ˆè¿è¡Œæµ‹è¯•2åˆ›å»º3Då¡ç‰‡', 'error');
                return;
            }
            
            addLog('log4', 'å¼€å§‹å½•åˆ¶è§†é¢‘ï¼ˆè‡ªå®šä¹‰å‚æ•°ï¼‰...', 'info');
            addLog('log4', 'å‚æ•°: 3ç§’, 30 FPS, æ—‹è½¬0.5åœˆ', 'info');
            
            try {
                const videoRecorder = window.testApp.getVideoRecorder();
                await videoRecorder.recordVideo({
                    duration: 3000,
                    fps: 30,
                    bitrate: 3000000,
                    rotations: 0.5
                });
                
                addLog('log4', 'âœ“ è§†é¢‘å½•åˆ¶å®Œæˆ', 'success');
                addLog('log4', 'âœ“ è§†é¢‘å·²è‡ªåŠ¨ä¸‹è½½', 'success');
            } catch (error) {
                addLog('log4', `âœ— é”™è¯¯: ${error.message}`, 'error');
            }
        };
        
        // æµ‹è¯• 5: ç¼–ç¨‹æ–¹å¼å½•åˆ¶
        window.testProgrammaticRecording = async function() {
            clearLog('log5');
            addLog('log5', 'æ¼”ç¤ºå®Œæ•´çš„ç¼–ç¨‹æµç¨‹...', 'info');
            
            try {
                // 1. ç”Ÿæˆå›¾ç‰‡
                addLog('log5', 'æ­¥éª¤1: ç”Ÿæˆæµ‹è¯•å›¾ç‰‡', 'info');
                const frontImage = generateTestImage('APIæµ‹è¯•', '#9b59b6');
                const backImage = generateTestImage('ç¼–ç¨‹å½•åˆ¶', '#f39c12');
                
                // 2. åˆ›å»ºå¡ç‰‡
                addLog('log5', 'æ­¥éª¤2: åˆ›å»º3Då¡ç‰‡', 'info');
                const uploadManager = window.testApp.getUploadManager();
                await uploadManager.createCard({
                    frontImageData: frontImage,
                    backImageData: backImage
                });
                addLog('log5', 'âœ“ å¡ç‰‡åˆ›å»ºæˆåŠŸ', 'success');
                
                // 3. ç­‰å¾…ä¸€å°æ®µæ—¶é—´
                addLog('log5', 'æ­¥éª¤3: ç­‰å¾…æ¸²æŸ“ç¨³å®š', 'info');
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // 4. å½•åˆ¶è§†é¢‘
                addLog('log5', 'æ­¥éª¤4: å¼€å§‹å½•åˆ¶è§†é¢‘', 'info');
                const videoRecorder = window.testApp.getVideoRecorder();
                await videoRecorder.recordVideo({
                    duration: 4000,
                    fps: 60,
                    bitrate: 4000000,
                    rotations: 1
                });
                
                addLog('log5', 'âœ“ å®Œæ•´æµç¨‹æ‰§è¡ŒæˆåŠŸ', 'success');
                addLog('log5', 'âœ“ è§†é¢‘å·²ä¿å­˜åˆ°ä¸‹è½½æ–‡ä»¶å¤¹', 'success');
            } catch (error) {
                addLog('log5', `âœ— é”™è¯¯: ${error.message}`, 'error');
                console.error(error);
            }
        };
        
        // é¡µé¢åŠ è½½å®Œæˆæç¤º
        addLog('log1', 'æµ‹è¯•ç¯å¢ƒå·²å°±ç»ªï¼Œç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•', 'success');
    </script>
</body>
</html>

