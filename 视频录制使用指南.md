# 🎬 视频录制功能使用指南

## 📋 功能概述

新增的视频录制功能可以将3D卡片旋转一圈录制为视频文件。

### 主要特性

- ✅ **一键录制** - 点击按钮即可开始录制
- ✅ **自动旋转** - 卡片自动完成360度旋转
- ✅ **高质量输出** - 60 FPS，5 Mbps码率
- ✅ **平滑动画** - 使用EaseInOut缓动函数
- ✅ **自动下载** - 录制完成后自动保存
- ✅ **状态提示** - 录制中显示动画提示

---

## 🚀 快速开始

### 1. 启动本地服务器

```bash
cd C:\Users\Administrator\Desktop\3DModel
py -m http.server 8000
```

### 2. 访问页面

打开浏览器访问：`http://localhost:8000/1.html`

### 3. 创建3D卡片

1. 选择正面图片
2. 选择背面图片
3. （可选）选择3D模型文件
4. 点击"创建3D卡片"按钮

### 4. 生成视频

1. 等待3D卡片创建完成
2. 点击右上角的"🎬 生成视频"按钮
3. 观看卡片自动旋转一圈（约5秒）
4. 视频自动下载到本地

---

## 🎯 使用说明

### 按钮状态

#### 初始状态（禁用）
- 颜色：半透明红色
- 文本：`🎬 生成视频`
- 状态：`disabled`（不可点击）

#### 创建卡片后（启用）
- 颜色：鲜艳红色
- 文本：`🎬 生成视频`
- 状态：可点击

#### 录制中
- 颜色：绿色脉动动画
- 文本：`⏺️ 录制中...`
- 状态：`disabled`（防止重复点击）

#### 录制完成
- 自动恢复到启用状态
- 显示提示框：视频已下载
- 可以再次录制

---

## 📹 视频参数

### 输出格式

| 参数 | 值 |
|------|-----|
| 格式 | WebM |
| 编码 | VP9（首选）或 VP8（备选） |
| 帧率 | 60 FPS |
| 码率 | 5 Mbps |
| 时长 | 5秒 |
| 分辨率 | 取决于Canvas大小 |

### 动画参数

| 参数 | 值 |
|------|-----|
| 旋转角度 | 360度（2π弧度）|
| 动画时长 | 5000毫秒 |
| 缓动函数 | EaseInOut |
| 录制延迟 | 额外0.5秒（确保完整） |

---

## 🔄 格式转换

### WebM → MP4 转换方法

#### 方法1: 在线转换（最简单）

**推荐网站**：
- [CloudConvert](https://cloudconvert.com/webm-to-mp4) - 免费，高质量
- [Online-Convert](https://www.online-convert.com/convert/webm-to-mp4) - 可调节参数
- [Convertio](https://convertio.co/webm-mp4/) - 界面友好

**步骤**：
1. 访问网站
2. 上传 `.webm` 文件
3. 选择输出格式为 `MP4`
4. 点击"转换"
5. 下载转换后的 `.mp4` 文件

#### 方法2: FFmpeg（命令行）

**安装FFmpeg**：
```bash
# Windows (使用Chocolatey)
choco install ffmpeg

# 或直接下载：https://ffmpeg.org/download.html
```

**转换命令**：
```bash
# 基础转换
ffmpeg -i input.webm output.mp4

# 高质量转换
ffmpeg -i input.webm -c:v libx264 -crf 20 -preset slow output.mp4

# 指定分辨率
ffmpeg -i input.webm -s 1920x1080 output.mp4

# 批量转换（PowerShell）
Get-ChildItem *.webm | ForEach-Object { ffmpeg -i $_.FullName "$($_.BaseName).mp4" }
```

#### 方法3: VLC Media Player（桌面软件）

**步骤**：
1. 打开VLC，点击"媒体" → "转换/保存"
2. 添加 `.webm` 文件
3. 点击"转换/保存"
4. 配置文件选择 `Video - H.264 + MP3 (MP4)`
5. 选择目标文件位置
6. 点击"开始"

#### 方法4: HandBrake（推荐桌面软件）

**下载**：[https://handbrake.fr/](https://handbrake.fr/)

**特点**：
- 完全免费开源
- 界面友好
- 支持批量转换
- 可调节编码参数

---

## 🛠️ 技术实现

### 核心代码流程

```javascript
// 1. 获取Canvas视频流
const stream = canvas.captureStream(60);  // 60 FPS

// 2. 创建MediaRecorder
const mediaRecorder = new MediaRecorder(stream, {
    mimeType: 'video/webm;codecs=vp9',
    videoBitsPerSecond: 5000000  // 5 Mbps
});

// 3. 收集视频数据
mediaRecorder.ondataavailable = (event) => {
    recordedChunks.push(event.data);
};

// 4. 录制完成处理
mediaRecorder.onstop = () => {
    const blob = new Blob(recordedChunks, { type: 'video/webm' });
    // 下载视频...
};

// 5. 开始录制
mediaRecorder.start();

// 6. 执行旋转动画
function animateRotation() {
    // 使用EaseInOut缓动
    cube.rotation.y = startRotation + (endRotation - startRotation) * easeProgress;
    requestAnimationFrame(animateRotation);
}
```

### 缓动函数

使用EaseInOut缓动函数使旋转更加平滑：

```javascript
const easeProgress = progress < 0.5 
    ? 2 * progress * progress                    // 前半段：加速
    : 1 - Math.pow(-2 * progress + 2, 2) / 2;   // 后半段：减速
```

---

## ⚠️ 注意事项

### 录制期间

1. **不要切换标签页** - 可能导致帧率下降
2. **不要移动鼠标** - 不会影响录制，但避免误操作
3. **等待完成** - 录制中按钮会禁用，约5-6秒完成

### 浏览器兼容性

| 浏览器 | MediaRecorder | VP9编码 | 推荐度 |
|--------|--------------|---------|--------|
| Chrome 47+ | ✅ | ✅ | ⭐⭐⭐⭐⭐ |
| Firefox 25+ | ✅ | ✅ | ⭐⭐⭐⭐⭐ |
| Edge 79+ | ✅ | ✅ | ⭐⭐⭐⭐⭐ |
| Safari 14.1+ | ⚠️ | ❌ | ⭐⭐⭐ |

**Safari说明**：
- 支持MediaRecorder，但可能只支持H.264编码
- 输出格式可能是MP4而非WebM
- 建议优先使用Chrome/Firefox

### 性能要求

- **推荐配置**：
  - CPU: 中等性能以上
  - 内存: 4GB+
  - 显卡: 支持WebGL
  
- **最低配置**：
  - CPU: 双核
  - 内存: 2GB
  - 显卡: 集成显卡

---

## 🐛 常见问题

### Q1: 点击按钮没反应？

**检查项**：
- 是否已创建3D卡片？（按钮初始是禁用状态）
- 是否正在录制中？（录制中按钮会禁用）
- 浏览器控制台是否有错误？

### Q2: 视频质量不佳？

**优化方法**：
1. 调整码率（修改 `videoBitsPerSecond` 参数）
2. 使用Chrome浏览器（VP9编码质量最好）
3. 转换为MP4时选择高质量设置

### Q3: 录制过程卡顿？

**解决方案**：
- 关闭其他占用GPU的应用
- 降低浏览器缩放比例
- 使用性能模式（Chrome: chrome://flags）
- 减少Canvas尺寸

### Q4: 文件太大？

**压缩方法**：
```bash
# 使用FFmpeg压缩
ffmpeg -i input.webm -c:v libvpx-vp9 -crf 30 -b:v 2M output.webm

# 转MP4并压缩
ffmpeg -i input.webm -c:v libx264 -crf 28 output.mp4
```

### Q5: 浏览器不支持？

**检测方法**：
```javascript
// 在浏览器控制台运行
console.log('MediaRecorder支持:', typeof MediaRecorder !== 'undefined');
console.log('VP9支持:', MediaRecorder.isTypeSupported('video/webm;codecs=vp9'));
console.log('VP8支持:', MediaRecorder.isTypeSupported('video/webm;codecs=vp8'));
```

---

## 🎨 自定义配置

### 修改录制时长

在 `1.html` 第1076行修改：

```javascript
const duration = 5000;  // 5秒 → 修改为想要的毫秒数
// 例如：const duration = 10000;  // 10秒
```

### 修改视频帧率

在 `1.html` 第1015行修改：

```javascript
const stream = canvas.captureStream(60);  // 60 FPS
// 可选：30, 60, 120
```

### 修改视频码率

在 `1.html` 第1020行修改：

```javascript
videoBitsPerSecond: 5000000  // 5 Mbps
// 更高质量：10000000 (10 Mbps)
// 更小文件：2000000 (2 Mbps)
```

### 修改旋转方向

在 `1.html` 第1079行修改：

```javascript
const endRotation = startRotation + Math.PI * 2;  // 顺时针
// 逆时针：const endRotation = startRotation - Math.PI * 2;
```

### 修改缓动函数

在 `1.html` 第1086-1088行修改：

```javascript
// 当前：EaseInOut
const easeProgress = progress < 0.5 
    ? 2 * progress * progress 
    : 1 - Math.pow(-2 * progress + 2, 2) / 2;

// 线性（匀速）：
const easeProgress = progress;

// EaseIn（慢 → 快）：
const easeProgress = progress * progress;

// EaseOut（快 → 慢）：
const easeProgress = 1 - Math.pow(1 - progress, 2);
```

---

## 📊 性能优化建议

### 1. 录制前优化

```javascript
// 暂时提高渲染质量
renderer.setPixelRatio(2);  // 高分辨率

// 禁用不必要的效果
lighting.setDynamicLightsEnabled(false);  // 关闭动态光
```

### 2. 录制中优化

- 使用固定帧率（60 FPS）
- 避免其他动画干扰
- 暂停自动旋转逻辑

### 3. 录制后优化

```javascript
// 恢复正常设置
renderer.setPixelRatio(window.devicePixelRatio);
lighting.setDynamicLightsEnabled(true);
```

---

## 📖 扩展阅读

### 相关API文档

- [MediaRecorder API - MDN](https://developer.mozilla.org/en-US/docs/Web/API/MediaRecorder)
- [HTMLCanvasElement.captureStream() - MDN](https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/captureStream)
- [WebM格式说明](https://www.webmproject.org/)

### 编码格式对比

| 格式 | 质量 | 文件大小 | 浏览器支持 | 推荐度 |
|------|------|----------|-----------|--------|
| VP9 | ⭐⭐⭐⭐⭐ | 中等 | Chrome/Firefox | ⭐⭐⭐⭐⭐ |
| VP8 | ⭐⭐⭐⭐ | 较大 | 广泛支持 | ⭐⭐⭐⭐ |
| H.264 | ⭐⭐⭐⭐⭐ | 小 | 全平台 | ⭐⭐⭐⭐⭐ |

---

## 💡 使用技巧

### 技巧1: 批量录制

如果需要录制多个不同的卡片：

1. 创建第一个卡片 → 生成视频
2. 刷新页面（或清空场景）
3. 创建第二个卡片 → 生成视频
4. 重复...

### 技巧2: 多角度录制

修改代码可以实现多角度旋转：

```javascript
// 在animateRotation函数中添加
cube.rotation.x = Math.sin(progress * Math.PI) * 0.2;  // X轴轻微摆动
```

### 技巧3: 录制GIF

虽然直接输出是WebM，但可以转换为GIF：

```bash
# 使用FFmpeg
ffmpeg -i input.webm -vf "fps=10,scale=800:-1:flags=lanczos" output.gif
```

### 技巧4: 预览后录制

在录制前，可以先手动旋转预览效果，确认角度无误后再录制。

---

## 🎓 总结

视频录制功能为3D卡片项目增添了强大的导出能力。通过简单的点击操作，即可生成高质量的旋转演示视频，非常适合：

- 📱 社交媒体分享
- 🎨 作品展示
- 📧 邮件附件
- 🖼️ 产品演示
- 🎬 视频素材

享受您的3D卡片创作之旅！🚀

---

**最后更新**: 2025-10-27
**版本**: 1.0.0

